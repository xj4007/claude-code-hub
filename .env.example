# 管理员令牌（请务必更改此值以确保安全性）
ADMIN_TOKEN=change-me

# 自动迁移控制（生产环境默认开启）
# 设置为 false 可禁用自动迁移
AUTO_MIGRATE=true

# 数据库连接字符串（仅用于本地开发或非 Docker Compose 部署）
DSN="postgres://user:password@host:port/db_name"

# 数据库配置（Docker Compose 部署时使用）
DB_USER=postgres
DB_PASSWORD=your-secure-password_change-me
DB_NAME=claude_code_hub

# 应用配置
APP_PORT=23000
APP_URL=                                   # 应用访问地址（留空自动检测，生产环境建议显式配置）
                                           # 示例：https://your-domain.com 或 http://192.168.1.100:23000

# API 测试配置
# API 测试请求超时时间（毫秒），范围 5000-120000。未设置时默认 15000。
API_TEST_TIMEOUT_MS=15000

# Cookie 安全策略
# 功能说明：控制是否强制 HTTPS Cookie（设置 cookie 的 secure 属性）
# - true (默认)：仅允许 HTTPS 传输 Cookie，浏览器会自动放行 localhost 的 HTTP
# - false：允许 HTTP 传输 Cookie（会降低安全性，仅推荐用于内网部署）
# 警告：若设置为 true 且使用远程 HTTP 访问，浏览器将拒绝设置 Cookie 导致无法登录
ENABLE_SECURE_COOKIES=true

# Redis 配置（用于限流和 Session 追踪）
# 功能说明：
# - 限流功能：金额限制（5小时/周/月）+ Session 并发限制
# - Session 追踪：5 分钟上下文缓存优化（避免频繁切换供应商）
# - Fail Open 策略：Redis 不可用时自动降级，不影响服务可用性
ENABLE_RATE_LIMIT=true                  # 是否启用限流功能（默认：true）
REDIS_URL=redis://localhost:6379        # Redis 连接地址（Docker 部署使用 redis://redis:6379，支持 rediss:// TLS）
REDIS_TLS_REJECT_UNAUTHORIZED=true      # 是否验证 Redis TLS 证书（默认：true）
                                        # 设置为 false 可跳过证书验证，用于自签证书或共享证书场景
                                        # 仅在 rediss:// 协议时生效

# Session 配置
SESSION_TTL=300                         # Session 过期时间（秒，默认 300 = 5 分钟）
STORE_SESSION_MESSAGES=false            # 是否存储请求 messages 到 Redis（用于实时监控页面查看详情，默认：false）
                                        # 警告：启用后会增加 Redis 内存使用，且可能包含敏感信息

# 熔断器配置
# 功能说明：控制网络错误是否计入熔断器失败计数
# - false (默认)：网络错误（DNS 解析失败、连接超时、代理连接失败等）不计入熔断器，仅供应商错误（4xx/5xx HTTP 响应）计入
# - true：所有错误（包括网络错误）都计入熔断器失败计数
# 使用场景：
# - 默认关闭：适用于网络不稳定环境（如使用代理），避免因临时网络抖动触发熔断器
# - 启用：适用于网络稳定环境，连续网络错误也应触发熔断保护，避免持续请求不可达的供应商
ENABLE_CIRCUIT_BREAKER_ON_NETWORK_ERRORS=false

# Fetch 连接超时配置
# 功能说明：控制 TCP 连接建立超时时间（包括 DNS 查询、TCP 握手、TLS 握手）
# - 默认值：30000 毫秒（30 秒）
# - 取值范围：建议 5000-120000 毫秒（5-120 秒）
# 使用场景：
# - 缩短此值可快速切换到备用供应商，当供应商被攻击或无响应时
# - 增加此值适用于网络不稳定环境，避免因网络抖动导致连接失败
FETCH_CONNECT_TIMEOUT=30000

# Fetch 响应头超时配置
# 功能说明：控制等待响应头的超时时间（通常可近似理解为“等待首字节/首包”的上限）
# - 默认值：600000 毫秒（600 秒）
# - 取值范围：建议 10000-600000 毫秒（10-600 秒）
# 使用场景：
# - 需要支持长时间首字节等待（例如某些模型/代理的排队或冷启动）时，可适当增大
# - 希望更快失败并切换供应商时，可适当减小
FETCH_HEADERS_TIMEOUT=600000

# Fetch 响应体超时配置
# 功能说明：控制请求/响应体传输超时（undici 会监控 body 数据接收间隔，超时则中断请求）
# - 默认值：600000 毫秒（600 秒）
# - 取值范围：建议 10000-600000 毫秒（10-600 秒）
# 使用场景：
# - 流式响应或长推理模型：建议保留较大值，避免被 undici 默认 300s 先行终止
# - 希望快速失败并切换供应商：可适当减小
FETCH_BODY_TIMEOUT=600000
MAX_RETRY_ATTEMPTS_DEFAULT=2                # 单供应商最大尝试次数（含首次调用），范围 1-10，留空使用默认值 2

# 智能探测配置
# 功能说明：当熔断器处于 OPEN 状态时，定期探测供应商以实现更快恢复
# - ENABLE_SMART_PROBING：是否启用智能探测（默认：false）
# - PROBE_INTERVAL_MS：探测周期间隔（毫秒，默认：30000 = 30秒）
# - PROBE_TIMEOUT_MS：单次探测超时时间（毫秒，默认：5000 = 5秒）
# 工作原理：
# - 定期检查处于 OPEN 状态的熔断器
# - 使用轻量级测试请求探测供应商
# - 探测成功则提前将熔断器转为 HALF_OPEN 状态
ENABLE_SMART_PROBING=false
PROBE_INTERVAL_MS=30000
PROBE_TIMEOUT_MS=5000

# 多提供商类型支持（实验性功能）
# - false (默认)：仅支持 Claude、Codex类型供应商
# - true：支持 Gemini CLI、OpenAI Compatible 等其他类型
# 警告：其他类型功能仍在开发中，暂不建议启用
ENABLE_MULTI_PROVIDER_TYPES=false
